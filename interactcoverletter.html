
<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Free ATS Optimized Cover Letter Builder</title>
    <meta name="description" content="Craft the perfect, ATS-optimized cover letter for any job application. Our free builder guides you section by section to create a professional and compelling letter. Download as a Word document.">
    <meta name="keywords" content="cover letter builder, free cover letter, cover letter generator, ATS cover letter, job application, resume, cv, job seeking, career advice">
    <meta name="author" content="Vishal Kondabathini">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://viskon.github.io/interactcoverletter.html" />
    <!-- Open Graph Meta Tags (for social sharing) -->
    <meta property="og:title" content="Free ATS Optimized Cover Letter Builder" />
    <meta property="og:description" content="Craft the perfect, ATS-optimized cover letter for any job application. Our free builder guides you section by section to create a professional and compelling letter." />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://viskon.github.io/interactcoverletter.html" />
    <meta property="og:image" content="https://viskon.github.io/assets/metashare.png" />
    <meta property="og:site_name" content="InteractCV Cover Letter Generator" />
    <!-- Twitter Card Meta Tags -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Free ATS Optimized Cover Letter Builder">
    <meta name="twitter:description" content="Craft the perfect, ATS-optimized cover letter for any job application. Our free builder guides you section by section to create a professional and compelling letter.">
    <meta name="twitter:image" content="https://viskon.github.io/assets/metashare.png">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link rel="icon" href="/assets/favicon.ico" type="image/x-icon">

<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Interactive Cover Letter Builder</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;700;900&family=Lato:wght@400;700&family=Roboto:wght@400;700&family=Merriweather:wght@400;700&family=Lora:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(to right, #eef2f3, #8e9eab);
        }
        .progress-bar-fill {
            transition: width 0.5s ease-in-out;
        }
        .textarea-field {
            @apply w-full px-4 py-3 border border-gray-300 bg-white shadow-sm rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition;
        }
        .input-field {
             @apply w-full px-4 py-3 border border-gray-300 bg-white shadow-sm rounded-lg focus:ring-2 focus:ring-indigo-500 focus:border-transparent transition;
        }
        .guidance {
            @apply text-sm text-gray-500 italic bg-gray-100 p-3 rounded-lg border-l-4 border-indigo-400;
        }
        .styled-textarea {
            @apply transition-shadow focus:shadow-lg focus:bg-blue-50/50 text-center resize-none overflow-hidden w-full px-6 py-4 rounded-xl font-semibold text-xl text-gray-800 border-2 border-indigo-200 focus:border-blue-500;
        }
        .recommendation {
            @apply text-center text-gray-500 mt-1 px-2;
            font-size: 0.65rem; /* custom smaller size */
        }
    </style>
    <script src="/assets/js/firebase-config.js"></script>
    <script src="/assets/js/visit-counter-client.js"></script>
</head>
<body class="p-4 md:p-8">

    <div id="main-content">
        <div class="w-full max-w-7xl mx-auto mb-8 text-center">
            <div class="bg-white rounded-2xl shadow-lg p-6 relative">
                <a href="https://viskon.github.io/interactcvgenerator.html" class="absolute top-6 left-6 text-gray-400 hover:text-gray-700 transition-colors" title="Back to CV Builder">
                    <i class="fas fa-arrow-left text-2xl"></i>
                </a>
                <h1 class="text-4xl font-extrabold text-gray-800 mb-2">ATS Optimized Cover Letter Generator</h1>
                <p class="text-sm text-gray-500 tracking-wide">
                    Craft the perfect cover letter, section by section.
                </p>
                <div class="mt-6 flex flex-wrap justify-center gap-2">
                    <span class="text-xs font-medium bg-gray-100 text-gray-800 px-3 py-1 rounded-full">ATS Optimized</span>
                    <span class="text-xs font-medium bg-purple-100 text-purple-800 px-3 py-1 rounded-full">Works best on PC</span>
                    <span class="text-xs font-medium bg-yellow-100 text-yellow-800 px-3 py-1 rounded-full">Your usage is not tracked</span>
                    <span class="text-xs font-medium bg-green-100 text-green-800 px-3 py-1 rounded-full">No personal data is collected or saved</span>
                </div>
            </div>
            <div class="mt-6 flex flex-col md:flex-row items-center justify-center md:justify-start space-y-3 md:space-y-0 md:space-x-6 text-gray-500">
                         <p id="visit-counter" class="text-sm flex items-center">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 mr-1.5" viewBox="0 0 20 20" fill="currentColor">
                              <path d="M10 12a2 2 0 100-4 2 2 0 000 4z" />
                              <path fill-rule="evenodd" d="M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.022 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z" clip-rule="evenodd" />
                            </svg>
                            Anonymous Visits: <span id="visit-count" class="font-semibold ml-1">0</span>
                          </p>
                    </div>
        </div>

        <div class="w-full max-w-7xl mx-auto lg:grid lg:grid-cols-2 lg:gap-8 lg:items-start">
            <!-- Builder Card -->
            <div class="w-full bg-white rounded-2xl shadow-2xl p-8">
                <div id="builder-content">
                    <!-- Progress Bar -->
                    <div class="mb-8">
                        <div class="flex justify-between items-center mb-2">
                            <div>
                                <span class="text-base font-medium text-gray-700" id="progress-label">Cover Letter Progress</span>
                                <span id="progress-percent" class="text-sm font-medium text-gray-700 ml-2">0%</span>
                            </div>
                        </div>
                        <div class="w-full bg-gray-200 rounded-full h-2.5">
                            <div id="progress-bar" class="bg-indigo-600 h-2.5 rounded-full progress-bar-fill" style="width: 0%"></div>
                        </div>
                    </div>

                    <!-- Card Container -->
                    <div id="card-container" class="relative" style="min-height: 480px;">
                        <!-- Cards will be injected by JS -->
                    </div>
                </div>
                 <!-- Navigation Buttons -->
                <div class="flex justify-between mt-8 items-center">
                    <button id="prev-btn" class="transition text-5xl text-gray-400 hover:text-gray-600"><i class="fas fa-arrow-left"></i></button>
                    <button id="next-btn" class="transition text-5xl"><i class="fas fa-arrow-right"></i></button>
                </div>
            </div>

            <!-- Live Preview Section -->
            <div class="w-full bg-white rounded-2xl shadow-2xl p-8 mt-8 lg:mt-0 sticky top-8">
                <div id="preview-section">
                    <h3 class="text-center font-bold text-gray-500 mb-4 uppercase tracking-wider" id="preview-title">Live Preview</h3>
                    <div id="preview-area" class="bg-white p-8 rounded-lg border border-gray-200 shadow-inner h-[75vh] overflow-y-auto text-sm">
                        <!-- Cover Letter Preview will be rendered here by JS -->
                    </div>
                     <div class="text-center mt-6">
                        <button id="download-doc-btn" class="inline-block px-6 py-3 bg-gradient-to-r from-indigo-600 to-purple-600 text-white font-semibold rounded-full shadow-md transform hover:scale-105 transition-transform duration-300 text-base opacity-50 cursor-not-allowed" disabled>
                            <i class="fas fa-file-word mr-2"></i> Download as Word
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        function autoResize(element) {
            element.style.height = 'auto';
            element.style.height = (element.scrollHeight) + 'px';
        }

        function validateField(input) {
            const errorSpan = document.getElementById(`${input.id}-error`);
            let isValid = true;
            if (input.id === 'yourEmail') {
                const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
                isValid = emailRegex.test(input.value) || input.value === '';
            }
            if (input.id === 'yourPhone') {
                const phoneRegex = /^[+]*[(]{0,1}[0-9]{1,4}[)]{0,1}[-\s\./0-9]*$/;
                isValid = phoneRegex.test(input.value) || input.value === '';
            }

            if (isValid) {
                input.classList.remove('border-red-500');
                if(errorSpan) errorSpan.classList.add('hidden');
            } else {
                input.classList.add('border-red-500');
                if(errorSpan) errorSpan.classList.remove('hidden');
            }
        }

        document.addEventListener('DOMContentLoaded', () => {
            const cardContainer = document.getElementById('card-container');
            const prevBtn = document.getElementById('prev-btn');
            const nextBtn = document.getElementById('next-btn');
            const progressBar = document.getElementById('progress-bar');
            const progressPercent = document.getElementById('progress-percent');
            const previewArea = document.getElementById('preview-area');
            const downloadDocBtn = document.getElementById('download-doc-btn');

            let currentStep = 0;
            const coverLetterData = {
                yourInfo: { name: '', address: '', phone: '', email: '', linkedin: '' },
                date: new Date().toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' }),
                companyInfo: { managerName: '', managerTitle: '', companyName: '', companyAddress: '' },
                opening: '',
                bodyParagraphs: [''],
                companyConnection: '',
                closing: '',
                font: 'Poppins'
            };

            const steps = [
                { title: 'Your Information', icon: 'fa-user-tie', color: 'indigo' },
                { title: 'Company Information', icon: 'fa-building', color: 'sky' },
                { title: 'The Opening', icon: 'fa-door-open', color: 'emerald' },
                { title: 'Your Value Proposition', icon: 'fa-briefcase', color: 'amber' },
                { title: 'Your Interest in the Company', icon: 'fa-heart', color: 'rose' },
                { title: 'Closing Paragraph', icon: 'fa-pen-fancy', color: 'fuchsia' }
            ];

            function updateProgressBar() {
                const percentage = (currentStep / (steps.length - 1)) * 100;
                progressBar.style.width = `${percentage}%`;
                progressPercent.textContent = `${Math.round(percentage)}%`;
            }

            function updatePreview() {
                previewArea.style.fontFamily = `'${coverLetterData.font}', serif`;
                let previewHTML = `
                    <div class="text-right mb-8">
                        <p class="font-bold text-lg">${coverLetterData.yourInfo.name || ''}</p>
                        <p>${coverLetterData.yourInfo.address || ''}</p>
                        <p>${coverLetterData.yourInfo.phone || ''} ${coverLetterData.yourInfo.email ? `| ${coverLetterData.yourInfo.email}` : ''}</p>
                        <p>${coverLetterData.yourInfo.linkedin || ''}</p>
                    </div>
                    <div class="mb-8">
                        <p>${coverLetterData.date}</p>
                    </div>
                    <div class="mb-8">
                        <p>${coverLetterData.companyInfo.managerName || "Hiring Manager"}</p>
                        <p>${coverLetterData.companyInfo.managerTitle || ''}</p>
                        <p class="font-bold">${coverLetterData.companyInfo.companyName || ''}</p>
                        <p>${coverLetterData.companyInfo.companyAddress || ''}</p>
                    </div>
                    <div class="mb-4">
                        <p><strong>Dear ${coverLetterData.companyInfo.managerName || 'Hiring Manager'},</strong></p>
                    </div>
                    <div class="space-y-4 leading-relaxed">
                        <p>${coverLetterData.opening || '...'}</p>
                        ${coverLetterData.bodyParagraphs.map(p => p ? `<p>${p}</p>` : '').join('')}
                        <p>${coverLetterData.companyConnection || '...'}</p>
                        <p>${coverLetterData.closing || '...'}</p>
                    </div>
                    <div class="mt-8">
                        <p>Sincerely,</p>
                        <p class="mt-4">${coverLetterData.yourInfo.name || ''}</p>
                    </div>
                `;
                previewArea.innerHTML = previewHTML;
            }

            function navigate(direction) {
                saveStepData(currentStep);
                let nextStep = currentStep;
                if (direction === 'next' && currentStep < steps.length - 1) {
                    nextStep++;
                } else if (direction === 'prev' && currentStep > 0) {
                    nextStep--;
                }

                if (nextStep !== currentStep) {
                    currentStep = nextStep;
                    renderStep(currentStep);
                    updateProgressBar();
                    updateNavButtons();
                    updatePreview();
                }
            }

            function updateNavButtons() {
                prevBtn.style.visibility = currentStep === 0 ? 'hidden' : 'visible';
                const isValid = validateStep(currentStep);
                
                nextBtn.disabled = !isValid;
                
                if (currentStep === steps.length - 1) {
                    nextBtn.innerHTML = '<i class="fas fa-check"></i>';
                    nextBtn.classList.add('text-green-500');
                    nextBtn.disabled = true;
                    downloadDocBtn.disabled = false;
                    downloadDocBtn.classList.remove('opacity-50', 'cursor-not-allowed');
                } else {
                    nextBtn.innerHTML = '<i class="fas fa-arrow-right"></i>';
                    nextBtn.classList.remove('text-green-500');
                     nextBtn.classList.toggle('text-gray-400', !isValid);
                    nextBtn.classList.toggle('cursor-not-allowed', !isValid);
                    nextBtn.classList.toggle('text-indigo-500', isValid);
                }
            }
            
            window.handleInput = () => {
                saveStepData(currentStep);
                updatePreview();
                updateNavButtons();
            };
            
            function saveStepData(stepIndex) {
                const card = document.querySelector(`#card-${stepIndex}`);
                if (!card) return;

                switch(steps[stepIndex].title) {
                    case 'Your Information':
                        coverLetterData.yourInfo.name = card.querySelector('#yourName').value;
                        coverLetterData.yourInfo.address = card.querySelector('#yourAddress').value;
                        coverLetterData.yourInfo.phone = card.querySelector('#yourPhone').value;
                        coverLetterData.yourInfo.email = card.querySelector('#yourEmail').value;
                        coverLetterData.yourInfo.linkedin = card.querySelector('#yourLinkedin').value;
                        const fontSelect = card.querySelector('#font-select');
                        if (fontSelect) coverLetterData.font = fontSelect.value;
                        break;
                    case 'Company Information':
                        coverLetterData.companyInfo.managerName = card.querySelector('#managerName').value;
                        coverLetterData.companyInfo.managerTitle = card.querySelector('#managerTitle').value;
                        coverLetterData.companyInfo.companyName = card.querySelector('#companyName').value;
                        coverLetterData.companyInfo.companyAddress = card.querySelector('#companyAddress').value;
                        break;
                    case 'The Opening':
                        coverLetterData.opening = card.querySelector('#opening').value;
                        break;
                    case 'Your Value Proposition':
                        coverLetterData.bodyParagraphs = Array.from(card.querySelectorAll('.body-paragraph')).map(textarea => textarea.value);
                        break;
                    case 'Your Interest in the Company':
                        coverLetterData.companyConnection = card.querySelector('#companyConnection').value;
                        break;
                    case 'Closing Paragraph':
                        coverLetterData.closing = card.querySelector('#closing').value;
                        break;
                }
            }
            
            function validateStep(stepIndex) {
                const card = document.querySelector(`#card-${stepIndex}`);
                if (!card) return true;
                const minChars = 30;

                switch(steps[stepIndex].title) {
                    case 'Your Information':
                        return card.querySelector('#yourName')?.value.trim() !== '';
                    case 'Company Information':
                        return card.querySelector('#companyName')?.value.trim() !== '';
                    case 'The Opening':
                        return card.querySelector('#opening')?.value.trim().length >= minChars;
                    case 'Your Value Proposition':
                        const paragraphs = Array.from(card.querySelectorAll('.body-paragraph'));
                        return paragraphs.length > 0 && paragraphs.some(p => p.value.trim().length >= minChars);
                    case 'Your Interest in the Company':
                        return card.querySelector('#companyConnection')?.value.trim().length >= minChars;
                    case 'Closing Paragraph':
                        return card.querySelector('#closing')?.value.trim().length >= minChars;
                    default:
                        return true;
                }
            }

            function renderStep(stepIndex) {
                const step = steps[stepIndex];
                cardContainer.innerHTML = `<div id="card-${stepIndex}" class="card p-4 space-y-4"></div>`;
                const card = document.getElementById(`card-${stepIndex}`);
                
                const color = step.color;

                let content = `
                    <div class="bg-gradient-to-tr from-${color}-500/20 to-${color}-400/10 rounded-3xl shadow-2xl p-8 transition-all duration-500">
                        <div class="text-center mb-8">
                             <i class="fas ${step.icon} text-7xl text-${color}-400 mb-4"></i>
                             <h2 class="text-4xl font-extrabold text-${color}-700 mb-2 tracking-tight">${step.title}</h2>
                        </div>
                        <div class="form-content space-y-6"></div>
                    </div>`;
                card.innerHTML = content;
                
                const formContent = card.querySelector('.form-content');
                if (stepIndex <= 1) {
                    formContent.classList.add('max-w-xl', 'mx-auto');
                }

                switch(step.title) {
                    case 'Your Information':
                        formContent.innerHTML = `
                            <p class="guidance">Let's start with your contact details and choose a font for your letter.</p>
                            <div class="mb-6">
                                <label for="font-select" class="font-semibold text-gray-600 mb-2 flex items-center"><i class="fas fa-font w-5 mr-2 text-indigo-400"></i>Choose a Font</label>
                                <select id="font-select" class="input-field">
                                    <option value="Poppins">Poppins</option>
                                    <option value="Lato">Lato</option>
                                    <option value="Roboto">Roboto</option>
                                    <option value="Merriweather">Merriweather</option>
                                    <option value="Lora">Lora</option>
                                </select>
                            </div>
                            ${createRemovableInput('yourName', 'fa-user', 'Full Name', coverLetterData.yourInfo.name, { isRequired: true, recommendation: 'Your name is essential for the letter.' })}
                            ${createRemovableInput('yourAddress', 'fa-map-marker-alt', 'Full Address', coverLetterData.yourInfo.address, { isTextarea: true, recommendation: 'Recommended for formal letters.' })}
                            ${createRemovableInput('yourPhone', 'fa-phone', 'Phone Number', coverLetterData.yourInfo.phone, { recommendation: 'Recommended for quick contact.' })}
                            ${createRemovableInput('yourEmail', 'fa-envelope', 'Email Address', coverLetterData.yourInfo.email, { recommendation: 'Essential for digital communication.' })}
                            ${createRemovableInput('yourLinkedin', 'fa-linkedin', 'LinkedIn Profile URL', coverLetterData.yourInfo.linkedin, { recommendation: 'Good for showing your professional profile.' })}
                        `;
                        break;
                    case 'Company Information':
                        formContent.innerHTML = `
                            <p class="guidance">Address the letter to a specific person if possible. If you can't find a name, 'Hiring Manager' is a safe default.</p>
                            ${createRemovableInput('managerName', 'fa-user-tie', "Hiring Manager's Name", coverLetterData.companyInfo.managerName, { recommendation: 'Highly recommended for a personal touch.' })}
                            ${createRemovableInput('managerTitle', 'fa-id-badge', "Hiring Manager's Title", coverLetterData.companyInfo.managerTitle, { recommendation: 'Optional, but adds professionalism.' })}
                            ${createRemovableInput('companyName', 'fa-building', 'Company Name', coverLetterData.companyInfo.companyName, { isRequired: true, recommendation: 'This field is required.' })}
                            ${createRemovableInput('companyAddress', 'fa-globe', "Company's Full Address", coverLetterData.companyInfo.companyAddress, { isTextarea: true, recommendation: 'Recommended for formal letters.' })}
                        `;
                        break;
                    case 'The Opening':
                        renderTextareaStep(formContent, 'opening', "Example: I am writing to express my enthusiastic interest in the [Job Title] position I found on [Platform, e.g., LinkedIn]...", "Start strong! State the position you're applying for and where you saw it. Express your enthusiasm for the role and the company right away.", coverLetterData.opening, color);
                        break;
                    case 'Your Value Proposition':
                        formContent.innerHTML = `<p class="guidance">This is the core of your letter. For each key requirement in the job description, write a short paragraph with a specific example of how you've demonstrated that skill.</p>`;
                        formContent.innerHTML += `<div id="body-paragraphs-container" class="space-y-4">${renderBodyParagraphs(color)}</div>`;
                        formContent.innerHTML += `<button id="add-paragraph-btn" class="text-indigo-600 hover:text-indigo-800 font-semibold text-sm mt-2">+ Add another paragraph</button>`;
                        break;
                    case 'Your Interest in the Company':
                        renderTextareaStep(formContent, 'companyConnection', "Example: I am particularly drawn to [Company Name]'s commitment to [Company Value, e.g., sustainability]...", "Show you've done your homework. Why this company? Mention their mission, a recent project, or company values that resonate with you.", coverLetterData.companyConnection, color);
                        break;
                    case 'Closing Paragraph':
                         renderTextareaStep(formContent, 'closing', "Example: With my proven track record in [Your Key Skill], I am confident I can contribute significantly to your team's success...", "End with confidence. Briefly reiterate your key qualification and your excitement. State that you've attached your resume and look forward to discussing the opportunity.", coverLetterData.closing, color);
                        break;
                }
                
                const emailInput = card.querySelector('#yourEmail');
                const phoneInput = card.querySelector('#yourPhone');
                if (emailInput) emailInput.addEventListener('input', () => validateField(emailInput));
                if (phoneInput) phoneInput.addEventListener('input', () => validateField(phoneInput));
                
                const fontSelect = card.querySelector('#font-select');
                if (fontSelect) {
                    fontSelect.value = coverLetterData.font;
                    fontSelect.addEventListener('change', handleInput);
                }

                if (step.title === 'Your Value Proposition') {
                    document.getElementById('add-paragraph-btn').addEventListener('click', () => {
                        saveStepData(currentStep);
                        coverLetterData.bodyParagraphs.push('');
                        renderStep(currentStep);
                    });
                }
            }

            function renderTextareaStep(formContent, id, placeholder, guidance, value, color) {
                const minChars = 30;
                formContent.innerHTML = `
                    <p class="guidance">${guidance}</p>
                    <textarea id="${id}" class="w-full p-4 border-2 border-${color}-200 rounded-xl focus:ring-2 focus:ring-${color}-500" rows="8" placeholder="${placeholder}" oninput="handleInput()">${value}</textarea>
                    <div class="text-right text-xs text-gray-500"><span id="char-count">${value.trim().length}</span> / ${minChars} min characters</div>
                    <div id="min-char-error" class="text-red-500 text-xs mt-1 text-center ${value.trim().length >= minChars ? 'hidden' : ''}">Please write a bit more to proceed.</div>
                `;

                const textarea = formContent.querySelector('textarea');
                const charCountSpan = formContent.querySelector('#char-count');
                const minCharError = formContent.querySelector('#min-char-error');

                textarea.addEventListener('input', () => {
                    const count = textarea.value.trim().length;
                    charCountSpan.textContent = count;
                    minCharError.classList.toggle('hidden', count >= minChars);
                    charCountSpan.classList.toggle('text-red-500', count < minChars);
                });
            }

            function createRemovableInput(id, icon, placeholder, value, options = {}) {
                const { isTextarea = false, isRequired = false, recommendation = '' } = options;
                const onInputLogic = `handleInput();`;
                const validationLogic = (id === 'yourEmail' || id === 'yourPhone') ? `validateField(this);` : '';
                const inputType = isTextarea 
                    ? `<textarea id="${id}" rows="1" class="styled-textarea" placeholder="${placeholder}" oninput="${onInputLogic}; ${validationLogic} autoResize(this);">${value}</textarea>`
                    : `<input id="${id}" class="styled-textarea" placeholder="${placeholder}" value="${value}" oninput="${onInputLogic} ${validationLogic}">`;

                return `
                    <div class="relative group mb-4">
                        <label for="${id}" class="font-semibold text-gray-600 mb-2 flex items-center"><i class="fas ${icon} w-5 mr-2 text-indigo-400"></i>${placeholder}</label>
                        ${inputType}
                        <div id="${id}-error" class="text-red-500 text-xs mt-1 hidden text-center">Invalid format</div>
                        ${recommendation ? `<div class="recommendation">${recommendation}</div>` : ''}
                    </div>
                `;
            }

            function renderBodyParagraphs(color) {
                const minChars = 30;
                return coverLetterData.bodyParagraphs.map((p, i) => `
                    <div class="relative">
                        <textarea class="body-paragraph w-full p-4 border-2 border-${color}-200 rounded-xl focus:ring-2 focus:ring-${color}-500" rows="5" placeholder="Paragraph ${i + 1}: Connect your experience to a specific job requirement..." oninput="handleInput()">${p}</textarea>
                        <div class="text-right text-xs text-gray-500"><span class="char-count">${p.trim().length}</span> / ${minChars} min characters</div>
                        ${coverLetterData.bodyParagraphs.length > 1 ? `<button class="absolute top-2 right-2 text-red-500 hover:text-red-700 font-bold" onclick="removeParagraph(${i})">&times;</button>` : ''}
                    </div>
                `).join('');
            }

            window.removeParagraph = (index) => {
                saveStepData(currentStep);
                coverLetterData.bodyParagraphs.splice(index, 1);
                renderStep(currentStep);
                updatePreview();
            };

            nextBtn.addEventListener('click', () => navigate('next'));
            prevBtn.addEventListener('click', () => navigate('prev'));
            
            function generateAndDownloadDocx() {
                downloadDocBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i> Generating...';
                downloadDocBtn.disabled = true;
                const font = coverLetterData.font;
                const googleFont = font.replace(' ', '+');
                const printableHtml = `
                    <html xmlns:o='urn:schemas-microsoft-com:office:office' xmlns:w='urn:schemas-microsoft-com:office:word' xmlns='http://www.w3.org/TR/REC-html40'>
                    <head><meta charset='utf-8'><title>Cover Letter</title>
                    <link href="https://fonts.googleapis.com/css2?family=${googleFont}:wght@400;700&display=swap" rel="stylesheet">
                    <style>
                        body { font-family: '${font}', serif; font-size: 11pt; line-height: 1.5; }
                        p { margin: 0 0 1em 0; }
                    </style>
                    </head>
                    <body>
                        <div style="text-align: right; margin-bottom: 32px;">
                            <p style="margin:0; font-weight: bold; font-size: 14pt;">${coverLetterData.yourInfo.name}</p>
                            <p style="margin:0;">${coverLetterData.yourInfo.address}</p>
                            <p style="margin:0;">${coverLetterData.yourInfo.phone} | ${coverLetterData.yourInfo.email}</p>
                            <p style="margin:0;">${coverLetterData.yourInfo.linkedin}</p>
                        </div>
                        <div style="margin-bottom: 32px;">
                            <p style="margin:0;">${coverLetterData.date}</p>
                        </div>
                        <div style="margin-bottom: 32px;">
                            <p style="margin:0;">${coverLetterData.companyInfo.managerName}</p>
                            <p style="margin:0;">${coverLetterData.companyInfo.managerTitle}</p>
                            <p style="margin:0; font-weight: bold;">${coverLetterData.companyInfo.companyName}</p>
                            <p style="margin:0;">${coverLetterData.companyInfo.companyAddress}</p>
                        </div>
                        <div style="margin-bottom: 16px;">
                            <p><strong>Dear ${coverLetterData.companyInfo.managerName},</strong></p>
                        </div>
                        <div style="text-align: justify;">
                            <p style="text-indent: 40px;">${coverLetterData.opening}</p>
                            ${coverLetterData.bodyParagraphs.map(p => `<p style="text-indent: 40px;">${p}</p>`).join('')}
                            <p style="text-indent: 40px;">${coverLetterData.companyConnection}</p>
                            <p style="text-indent: 40px;">${coverLetterData.closing}</p>
                        </div>
                        <div style="margin-top: 32px;">
                            <p>Sincerely,</p>
                            <p style="margin-top: 48px;">${coverLetterData.yourInfo.name}</p>
                        </div>
                    </body>
                    </html>
                `;
                
                const source = 'data:application/vnd.ms-word;charset=utf-8,' + encodeURIComponent(printableHtml);
                const fileDownload = document.createElement("a");
                document.body.appendChild(fileDownload);
                fileDownload.href = source;
                const name = coverLetterData.yourInfo.name || 'CoverLetter';
                fileDownload.download = `CoverLetter_${name.replace(/\s+/g, '_')}.doc`;
                fileDownload.click();
                document.body.removeChild(fileDownload);

                setTimeout(() => {
                    downloadDocBtn.innerHTML = '<i class="fas fa-file-word mr-2"></i> Download as Word';
                    if(currentStep === steps.length - 1) {
                        downloadDocBtn.disabled = false;
                    }
                }, 1000);
            }
            
            downloadDocBtn.addEventListener('click', generateAndDownloadDocx);

            // Initial render
            renderStep(0);
            updateNavButtons();
            updateProgressBar();
            updatePreview();
        });
    </script>
</body>
</html>

